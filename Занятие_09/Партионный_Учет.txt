Процедура ЗаполнитьНЗ_ОстаткиТоваровПоПартиям(ВыборкаПоНоменклатуре)
	
	ОсталосьСписать = ВыборкаПоНоменклатуре.ДокКол;
	
	Выборка = ВыборкаПоНоменклатуре.Выбрать();
	
	ПОка Выборка.Следующий() Цикл
		
		ЩасСпишу = Мин(ОсталосьСписать, Выборка.РегКол);
		
		Если ЩасСпишу <= 0 Тогда
			 Продолжить;
		КонецЕсли; 
		
		Движение = Движения.ОстаткиТоваровПоПартиям.Добавить();
		
		Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
		
		Движение.Период = Дата;
		Движение.Номенклатура = Выборка.Номенклатура;
		
		Движение.Партия = Выборка.Партия;
		
		Движение.Количество = ЩасСпишу;
		
		Если ЩасСпишу = Выборка.РегКол Тогда
			Себестоимость  = Выборка.РегСум;
		Иначе
			Себестоимость  = Выборка.РегСум / Выборка.РегКол * ЩасСпишу;
		КонецЕсли; 
		
		Движение.Сумма = Себестоимость;
		
		ОсталосьСписать = ОсталосьСписать - ЩасСпишу;
		
		Если ОсталосьСписать = 0 Тогда
		
			Прервать;
		
		КонецЕсли; 
		
	КонецЦикла;

	
КонецПроцедуры
