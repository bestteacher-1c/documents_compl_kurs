Функция ПересчитатьИзВалютыВВалюту(ВалютаИЗ,ВалютаВ,СуммаИз,Дата) Экспорт 

	Если СуммаИз = 0 Тогда
		Возврат 0;
	КонецЕсли;
	
	Если ВалютаИЗ = Неопределено Тогда
		ВалютаИЗ = Справочники.Валюты.РубльРФ;
	КонецЕсли;
	
	Если ВалютаВ = Неопределено Тогда
		ВалютаВ = Справочники.Валюты.РубльРФ;
	КонецЕсли;
	
	Если ВалютаВ = ВалютаИЗ Тогда
		Возврат СуммаИз;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"	ВЫБРАТЬ
	 	|	СУММА(ВЫБОР
	 	|			КОГДА КурсыВалютСрезПоследних.Валюта = &ВалютаВ
	 	|				ТОГДА КурсыВалютСрезПоследних.Курс
	 	|			ИНАЧЕ 0
	 	|		КОНЕЦ) КАК КурсВ,
	 	|	СУММА(ВЫБОР
	 	|			КОГДА КурсыВалютСрезПоследних.Валюта = &ВалютаИз
	 	|				ТОГДА КурсыВалютСрезПоследних.Курс
	 	|			ИНАЧЕ 0
	 	|		КОНЕЦ) КАК КурсИз
	 	|ПОМЕСТИТЬ ВТИсходная
	 	|ИЗ
	 	|	РегистрСведений.КурсыВалют.СрезПоследних(&Дата, Валюта В (&ВалютаИз, &ВалютаВ)) КАК КурсыВалютСрезПоследних
	 	|;
	 	|
	 	|////////////////////////////////////////////////////////////////////////////////
	 	|ВЫБРАТЬ
	 	|	ВЫБОР ВТИсходная.КурсВ
	 	|		КОГДА 0
	 	|			ТОГДА 0
	 	|		ИНАЧЕ &СуммаИЗ * ВТИсходная.КурсИз / ВТИсходная.КурсВ
	 	|	КОНЕЦ КАК СуммаВ
	 	|ИЗ
	 	|	ВТИсходная КАК ВТИсходная";
	
	Запрос.УстановитьПараметр("ВалютаИЗ", ВалютаИЗ);
	Запрос.УстановитьПараметр("ВалютаВ", ВалютаВ);
	Запрос.УстановитьПараметр("СуммаИЗ", СуммаИЗ);
	Запрос.УстановитьПараметр("Дата", Дата);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл

		Возврат ВыборкаДетальныеЗаписи.СуммаВ;
		
	КонецЦикла;

	Возврат 0;

КонецФункции // ПересчитатьИзВалютыВВалюту()
